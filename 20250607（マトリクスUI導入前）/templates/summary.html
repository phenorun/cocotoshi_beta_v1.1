{% extends "layout.html" %}
{% block content %}

<h2 style="margin-bottom:0;">ğŸ“Š ä¿æœ‰éŠ˜æŸ„ã®é›†è¨ˆ</h2>

<div style="width:100%; max-width:1200px; margin:0 auto 1em auto; display:flex; justify-content:flex-end;">
  <form method="get" action="/summary" style="display:flex; gap:4px; align-items:center;">
    <input type="text" name="q" placeholder="æ¤œç´¢" value="{{ request.args.get('q', '') }}" style="width: 140px;">
    <button type="submit">æ¤œç´¢</button>
    <button type="button" id="clear-btn">ã‚¯ãƒªã‚¢</button>
  </form>
</div>

<style>
/* ã‚¹ãƒãƒ›ç”¨ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
.summary-cards-container {
  display: flex;
  flex-direction: column;
  gap: 0.8em;
  max-width: 520px;
  margin: 0 auto 2em auto;
}
.summary-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px #eee;
  padding: 0.9em 1em 0.5em 1em;
  width: 100%;
  display: flex;
  flex-direction: column;
  font-size: 15px;
  gap: 0.1em;
}

.summary-card-row1 {
  display: flex;
  align-items: center;
  gap: 0.45em;
  flex-wrap: wrap;
}
.summary-stock-name {
  font-weight: bold;
  font-size: 1.08em;
  margin-right: 0.2em;
}
.summary-type-buy {
  color: #0070e0; border: 1px solid #0070e0; border-radius: 5px; padding: 0 0.32em;
}
.summary-type-sell {
  color: #d00; border: 1px solid #d00; border-radius: 5px; padding: 0 0.32em;
}
.summary-purpose {
  background: #f5f7fb; border-radius: 3px; padding: 0 0.4em; font-size: 0.98em; color: #333;
}
.summary-feeling { font-size: 1.1em; margin: 0 0.13em; }
.summary-btn {
  margin-left: auto;
  padding: 0.36em 1.18em;
  font-size: 1em;
  background: #0074d9;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  min-width: 55px;
  min-height: 32px;
  box-shadow: 0 1px 2px #eaeaea;
}

/* 2è¡Œç›®ï¼šä¿æœ‰æ—¥æ•°ã¨æ ªæ•°ï¼ˆå·¦å¯„ã›ï¼‰ */
.summary-card-row2 {
  display: flex;
  gap: 1.3em;
  font-size: 0.97em;
  color: #333;
  margin-bottom: 0.05em;
  margin-top: 0.08em;
}

/* ãƒ¢ãƒã‚¤ãƒ«ç‰¹åŒ– */
@media (max-width: 600px) {
  .summary-cards-container { max-width: 99vw; font-size: 13px; }
  .summary-btn { font-size: 0.99em; padding: 0.3em 0.9em; min-width: 44px; }
  .summary-stock-name { font-size: 1.01em; }
}
</style>

<div class="summary-cards-container">
  {% for row in summary_data %}
    {# row: [code, stock, purpose, holding, avg_price, last_trade_date] #}
    <div class="summary-card">
      <div class="summary-card-row1">
        <span class="summary-stock-name">{{ row[1] }}</span>
        {% if row[3]|int >= 0 %}
          <span class="summary-type-buy">è²·</span>
        {% else %}
          <span class="summary-type-sell">å£²</span>
        {% endif %}
        <span class="summary-purpose">
          {% set purpose_icons = {
            'çŸ­æœŸ': 'ğŸ’¹ çŸ­æœŸ',
            'é•·æœŸ': 'ğŸ“ˆ é•·æœŸ',
            'ä¸­æœŸ': 'ğŸ“Š ä¸­æœŸ',
            'å„ªå¾…': 'ğŸ å„ªå¾…',
            'é…å½“': 'ğŸ’° é…å½“',
            'benefit': 'ğŸ’¹ åˆ©ç›Š',
            'dividend': 'ğŸ’° é…å½“',
            'long': 'ğŸ“ˆ é•·æœŸ',
            'middle': 'ğŸ“Š ä¸­æœŸ',
            'short': 'ğŸ’¹ çŸ­æœŸ'
          } %}
          {{ purpose_icons.get(row[2], row[2] or '-') }}
        </span>
        <span class="summary-feeling">ğŸ˜Š</span> {# â†ãŠå¥½ã¿ã§æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ã«å·®ã—æ›¿ãˆOK #}
        <button class="summary-btn" onclick="location.href='/history?q={{ row[0] }}'">å±¥æ­´</button>
      </div>
      <div class="summary-card-row2">
        <span>ä¿æœ‰æ—¥æ•°: ï¼</span>  <!-- ä¿æœ‰æ—¥æ•°ã®è¨ˆç®—ãŒæœªå®Ÿè£…ãªã‚‰ã€Œï¼ã€ã®ã¾ã¾ -->
        <span>æ ªæ•°: {{ "{:,}".format(row[3]|int) }}</span>
        <!-- å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã§å¹³å‡å–å¾—å˜ä¾¡ã‚„æ—¥ä»˜ã‚‚ã“ã“ã« -->
      </div>
    </div>
  {% endfor %}
</div>

<!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãã®ã¾ã¾æµç”¨ï¼‰ -->
{% if page is defined and total_pages is defined and total_pages >= 1 %}
  <div class="pagination" style="text-align:center; margin: 1em 0 90px 0; font-size: 1.4em;">
    {% if page > 1 %}
      <a href="?page={{ page - 1 }}{% if request.args.get('q') %}&q={{ request.args.get('q') }}{% endif %}">Â« å‰ã¸</a>
    {% endif %}
    <span style="margin:0 8px;">{{ page }} / {{ total_pages }}</span>
    {% if page < total_pages %}
      <a href="?page={{ page + 1 }}{% if request.args.get('q') %}&q={{ request.args.get('q') }}{% endif %}">æ¬¡ã¸ Â»</a>
    {% endif %}
  </div>
{% endif %}

<script>
  document.getElementById('clear-btn').onclick = function() {
    window.location.href = '/summary';
  };
</script>

{% endblock %}
