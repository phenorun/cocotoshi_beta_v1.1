{% extends "layout.html" %}
{% block content %}
  <h2 style="margin-bottom:0;">ğŸ“Š ä¿æœ‰éŠ˜æŸ„ã®é›†è¨ˆ</h2>

  <div style="width:100%; max-width:1200px; margin:0 auto 1em auto; display:flex; justify-content:flex-end;">
    <form method="get" action="/summary" style="display:flex; gap:4px; align-items:center;">
      <input type="text" name="q" placeholder="æ¤œç´¢" value="{{ request.args.get('q', '') }}" style="width: 140px;">
      <button type="submit">æ¤œç´¢</button>
      <button type="button" id="clear-btn">ã‚¯ãƒªã‚¢</button>
    </form>
  </div>

  <div style="overflow-x: auto;">
    <table style="min-width: 800px; white-space: nowrap;" border="1" cellpadding="8" cellspacing="0">
      <thead>
        <tr>
          <th>éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰</th>
          <th>éŠ˜æŸ„å</th>
          <th>ç¨®åˆ¥</th>
          <th>ä¿æœ‰æ ªæ•°</th>
          <th>å¹³å‡å–å¾—å˜ä¾¡</th>
          <th>æŠ•è³‡ç›®çš„</th>
          <th>è³¼å…¥æ—¥ï¼ˆæœ€çµ‚ï¼‰</th>
        </tr>
      </thead>
      <tbody>
        {% for row in summary_data %}
        <tr>
          <td>{{ row[0] }}</td>
          <td>{{ row[1] }}</td>
          <td>
            {% if row[3]|int >= 0 %}
              <span style="color: blue; font-weight: bold;">è²·</span>
            {% else %}
              <span style="color: red; font-weight: bold;">å£²</span>
            {% endif %}
          </td>
          <td style="text-align:right;">{{ "{:,}".format(row[3]|int) }}</td>
          <td style="text-align:right;">{{ "{:,}".format(row[4]|int | abs) }} å††</td>
          <td>
            {% set purpose_icons = {
              'çŸ­æœŸ': 'ğŸ’¹ çŸ­æœŸ',
              'é•·æœŸ': 'ğŸ“ˆ é•·æœŸ',
              'ä¸­æœŸ': 'ğŸ“Š ä¸­æœŸ',
              'å„ªå¾…': 'ğŸ å„ªå¾…',
              'é…å½“': 'ğŸ’° é…å½“'
            } %}
            {{ purpose_icons.get(row[2], row[2] or '-') }}
          </td>
          <td>{{ row[5] or '-' }}</td>
          <td><a href="/history?q={{ row[0] }}">å±¥æ­´</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script>
    document.getElementById('clear-btn').onclick = function() {
      window.location.href = '/summary';
    };
  </script>

  <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ä¸‹ï¼‰ -->
  {% if page is defined and total_pages is defined and total_pages >= 1 %}
    <div class="pagination" style="text-align:center; margin: 16px 0;">
      {% if page > 1 %}
        <a href="?page={{ page - 1 }}">Â« å‰ã¸</a>
      {% endif %}
      <span style="margin:0 8px;">{{ page }} / {{ total_pages }}</span>
      {% if page < total_pages %}
        <a href="?page={{ page + 1 }}">æ¬¡ã¸ Â»</a>
      {% endif %}
    </div>
  {% endif %}





{% endblock %}
